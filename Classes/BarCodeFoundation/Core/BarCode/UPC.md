#  UPC-你需要知道的基本知识点

*参考资料：https://en.wikipedia.org/wiki/Universal_Product_Code



掌握几个知识点：

1. 什么是UPC？
2. UPC用途
3. UPC-A组成
4. UPC-A校验码
5. UPC-A编码



## 什么是UPC

UPC全称**Universal Product Code**,中文翻译过来就是**通用产品代码**，是一种被广泛应用的条码符号（条形码），主要用来跟踪贸易商品。

UPC有多种类型：**UPC-A**、UPC-B、UPC-C、UPC-D、**UPC-E**、UPC-2、UPC-5

应用最广泛的是**UPC-A**和**UPC-E**

* UPC-A：长度为12位的纯数字，第1位数字是**系统数字（英文：Number system digit）**，紧接着5位为**厂商码，厂商码后5位是产品码**，最后1位为校验位
* UPC-E：长度为8位的纯数字，可转成UPC-A





## UPC用途

**主要用来跟踪贸易商品**

比如一个UPC-A码，12位数字中，第1位数字为系统数字，有5位数字代表这厂商，5位数字代表产品。系统数字不同值代表的意义不一样，5位厂商数字标识着不同的公司，5位产品数字标识不同的产品。

基于这些信息，可以很多好地追踪商品。




## UPC-A组成

**代码结构：**UPC-A长度为12位数字，第1位为**系统数字**，绝大多少商品，后面5位为**厂商编码**，再后5位为**产品编码**，最后1位为**校验码**

**条码的符号结构：** **起始符**、**左侧数据符**、**中间分隔符**、**右侧数据符**、**校验符**、**终止符**，起始符合终止符两侧还有**静区（9个空）**




## UPC-A校验位

前面11位数字（有一些资料描述用payload单词，下面我也用这个词吧）为有效内容，最后1位校验位，它是payload通过计算得到的数字。

算法：payload从右往左，奇数位数字乘以权重(3)，偶数位数字乘以权重(1)，然后所有结果相加得到总和（姑且命名sum吧），这个总和（sum）再对10求余数（计算机科学中一般表达mod 10），如果这个余数等于0，那么0就是最终的校验位，否则就用10-余数的结果作为校验位。总之，sum一定要给干到10的整数倍，如果不够10，就需要补差值，这个差值就是校验位。

如果没有看明白，那么举个例子就明白了：

例如：036000291452

payload：03600029145

计算：sum = 5x3+4x1+1*3+9x1+2x3+0+0+0+6x3+3x1+0 = 58

求余数：sum%10 = 2

校验位：2

下面用图表表达这个过程可能会更直观（奇数位Odd用O表示，偶数位Even用E表示）：

|       Barcode        |  0   |  3   |  6   |  0   |  0   |  0   |  2   |  9   |  1   |  4   | 5    |
| :------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | ---- |
| **Reversed Barcode** |  5   |  4   |  1   |  9   |  2   |  0   |  0   |  0   |  6   |  3   | 0    |
|     **Position**     |  O   |  E   |  O   |  E   |  O   |  E   |  O   |  E   |  O   |  E   | O    |
|    **Weighting**     |  3   |  1   |  3   |  1   |  3   |  1   |  3   |  1   |  3   |  1   | 3    |
|    **Caculation**    | 5*3  | 4*1  | 1*3  | 9*1  | 2*3  | 0*1  | 0*3  | 0*1  | 6*3  | 3*1  | 0*3  |
|   **Weighted Sum**   |  15  |  4   |  3   |  9   |  6   |  0   |  0   |  0   |  18  |  3   | 0    |





## UPC-A编码



UPC-A条形码由条（黑条）和空（白色间隙）组成，条或空我们称之为模块，一个完整的UPC-A条形码由开始边界，中间分割，结束边界和数据4个组成部分。

数据部分：每个数字用7个模块表达，UPC-A有12位数字，所以需要 7*12=84 个模块来表达。

开始边界：固定3个模块表达（条-空-条，即101）

中间分割：固定5个模块表达（空-条-空-条-空，即01010）

结束边界：和开始边界一样，固定3个模块表达（条-空-条，即101）

所以，一个完整的UPC-A条形码需要95个模块表达。另外，有一点需要说一下，在开始边界和结束边界外还需要9个空模块（静区），所以UPC-A需要113个模块。



### 奇编码、偶编码

一个数字的表达需要7个模块，如果这7个模块中条的个数为奇数个，那么这种编码就是奇编码，否则就是偶编码。

UPC-A 12位数字，左边6位采用奇编码规则，右边采用偶编码规则

| 数字字符 | 奇编码  | 偶编码  |
| -------- | ------- | ------- |
| 0        | 0001101 | 1110010 |
| 1        | 0011001 | 1100110 |
| 2        | 0010011 | 1101100 |
| 3        | 0111101 | 1000010 |
| 4        | 0100011 | 1011100 |
| 5        | 0110001 | 1001110 |
| 6        | 0101111 | 1010000 |
| 7        | 0111011 | 1000100 |
| 8        | 0110111 | 1001000 |
| 9        | 0001011 | 1110100 |

提及一句：奇编码0-1互换后其实就等于偶编码对应的值

不管是奇编码还是偶编码，它都是由2个条和2个空组成，这里的条的模块个数可能是1，2，3，4。



### 格式

假设单个模块元素的宽度为x	

* 标准尺寸下 UPC-A 的 x 尺寸为 0.33 毫米（0.013 英寸）。
* UPC-A 的L（左侧数据符）部分和R（右侧数据）部分高度为 25.9 毫米（1.02 英寸）。
* S（起始符）、M（中间分隔符）、 E（终止符）、第1位数字和最后1位数字（校验符）的条向下延伸 x 的 5 倍，即高度为 27.55 毫米（1.08 英寸）。
* UPC-A 可以缩小或放大 80% 到 200%。

1pt≈0.013英寸

代码层面即：

```swift
// 0.013 inch
let x: CGFloat = 1
// 1.02/0.013
let dataBarHeight: CGFloat = 78.5
// lrHeight+5x
let guardLineHeight: CGFloat = 83.5
```
